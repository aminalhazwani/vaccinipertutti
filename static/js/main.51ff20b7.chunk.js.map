{"version":3,"sources":["App.js","reportWebVitals.js","index.js"],"names":["App","fmtInt","formatLocale","numberItIT","format","timeLoc","timeFormatLocale","timeItIT","fmtDate","fmtISODate","useState","indexedData","setIndexedData","data","setData","areas","setAreas","useQueryParam","withDefault","StringParam","area","setArea","Date","lastUpdate","setLastUpdate","NumberParam","lastDays","setLastDays","lastDate","setLastDate","indexedPopulation","setIndexedPopulation","population","setPopulation","populationFraction","setPopulationFraction","doses","setDoses","administrationsPerDay","setAdministrationsPerDay","avgAdministrationsLastDays","setAvgAdministrationsLastDays","administrations","setAdministrations","remainingAdministrations","setRemainingAdministrations","remainingDays","setRemainingDays","targetMonth","setTargetMonth","getFullYear","targetYear","setTargetYear","targetDate","setTargetDate","targetAvgAdministrationsPerDay","setTargetAvgAdministrationsPerDay","useEffect","window","fetch","then","json","ultimo_aggiornamento","Object","fromEntries","group","d","res","sort","a","b","descending","data_somministrazione","currentDate","currentMonth","getMonth","selectedMonth","console","log","totale","rollups","v","sum","getTime","slice","days","datetime","setDate","getDate","Math","round","Container","maxWidth","Grid","container","direction","justify","spacing","item","nome","component","Select","value","length","onChange","e","target","map","MenuItem","toLowerCase","TextField","size","inputProps","type","min","max","step","InputProps","endAdornment","InputAdornment","position","floor","months","m","i","toLocaleLowerCase","className","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","theme","createMuiTheme","palette","secondary","main","typography","fontFamily","ReactDOM","render","StrictMode","ReactRouterRoute","Route","ThemeProvider","document","getElementById"],"mappings":"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","file":"static/js/main.51ff20b7.chunk.js","sourcesContent":["import { useEffect, useState } from 'react'\n\nimport {\n  useQueryParam,\n  NumberParam,\n  StringParam,\n  withDefault\n} from 'use-query-params'\n\nimport {\n  TextField,\n  InputAdornment,\n  Select,\n  MenuItem,\n  Container,\n  Grid\n} from '@material-ui/core'\n\nimport { rollups, group, sum, descending } from 'd3-array'\nimport { formatLocale } from 'd3-format'\nimport { timeFormatLocale } from 'd3-time-format'\nimport numberItIT from 'd3-format/locale/it-IT.json'\nimport timeItIT from 'd3-time-format/locale/it-IT.json'\n\nimport './App.css'\n\nfunction App () {\n  const numberLoc = formatLocale(numberItIT)\n  const fmtInt = numberLoc.format(',d')\n\n  const timeLoc = timeFormatLocale(timeItIT)\n  const fmtDate = timeLoc.format('%A %e %B %Y')\n  const fmtISODate = timeLoc.format('%Y-%M-%d')\n\n  const [indexedData, setIndexedData] = useState({})\n  const [data, setData] = useState([])\n  const [areas, setAreas] = useState([])\n  const [area, setArea] = useQueryParam('area', withDefault(StringParam, 'ITA'))\n  const [lastUpdate, setLastUpdate] = useState(new Date())\n  const [lastDays, setLastDays] = useQueryParam('lastDays', withDefault(NumberParam, 7))\n  const [lastDate, setLastDate] = useState(new Date())\n  const [indexedPopulation, setIndexedPopulation] = useState({})\n  const [population, setPopulation] = useState(6e7)\n  const [populationFraction, setPopulationFraction] = useQueryParam('populationFraction', withDefault(NumberParam, 0.8))\n  const [doses, setDoses] = useQueryParam('doses', withDefault(NumberParam, 2))\n  const [administrationsPerDay, setAdministrationsPerDay] = useState([])\n  const [avgAdministrationsLastDays, setAvgAdministrationsLastDays] = useState([])\n  const [administrations, setAdministrations] = useState(0)\n  const [remainingAdministrations, setRemainingAdministrations] = useState(0)\n  const [remainingDays, setRemainingDays] = useState(0)\n  const [targetMonth, setTargetMonth] = useQueryParam('targetMonth', withDefault(NumberParam, 11))\n  const [targetYear, setTargetYear] = useQueryParam('targetYear', withDefault(NumberParam, (new Date()).getFullYear()))\n  const [targetDate, setTargetDate] = useState(new Date())\n  const [targetAvgAdministrationsPerDay, setTargetAvgAdministrationsPerDay] = useState(0)\n\n  useEffect(() => {\n    window.fetch('../vaccinipertutti-data/last-update-dataset.json')\n      .then(data => data.json())\n      .then(data => { setLastUpdate(new Date(data.ultimo_aggiornamento)) })\n    window.fetch('../vaccinipertutti-data/popolazione_residente_2020.json')\n      .then(data => data.json())\n      .then(data => {\n        setAreas(data)\n        setIndexedPopulation(Object.fromEntries(group(data, d => d.area)))\n      })\n    window.fetch('../vaccinipertutti-data/somministrazioni-vaccini-summary-latest.json')\n      .then(res => res.json())\n      .then(res => res.data)\n      .then(data => data.sort((a, b) => descending(a.data_somministrazione, b.data_somministrazione)))\n      .then(data => { setIndexedData(Object.fromEntries(group(data, d => d.area))) })\n  }, [])\n\n  useEffect(() => {\n    const currentDate = new Date()\n    const currentMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0)\n    const selectedMonth = new Date(targetYear, targetMonth + 1, 0)\n    console.log(currentMonth, selectedMonth)\n    if (selectedMonth > currentMonth) {\n      setTargetDate(new Date(targetYear, targetMonth + 1, 0))\n    } else {\n      setTargetMonth(targetDate.getMonth())\n      setTargetYear(targetDate.getFullYear())\n    }\n  }, [targetMonth, targetYear])\n\n  useEffect(() => {\n    setData(indexedData[area] || [])\n  }, [indexedData, area])\n\n  useEffect(() => {\n    if (indexedPopulation[area]) {\n      setPopulation(indexedPopulation[area][0].totale)\n    }\n  }, [indexedPopulation, area])\n\n  useEffect(() => {\n    setAdministrationsPerDay(\n      rollups(\n        data,\n        v => sum(v, d => d.totale),\n        d => fmtISODate(new Date(d.data_somministrazione))\n      )\n    )\n\n    setAdministrations(\n      sum(data, d => d.totale)\n    )\n  }, [data])\n\n  useEffect(() => {\n    setTargetAvgAdministrationsPerDay(remainingAdministrations / (targetDate.getTime() - (new Date()).getTime()) * 1000 * 60 * 60 * 24)\n  }, [targetDate, remainingAdministrations])\n\n  useEffect(() => {\n    setAvgAdministrationsLastDays(\n      sum(\n        administrationsPerDay.slice(1, lastDays + 1),\n        d => d[1]\n      ) / lastDays\n    )\n  }, [administrationsPerDay, lastDays])\n\n  useEffect(() => {\n    setRemainingAdministrations(\n      doses * population * populationFraction - administrations\n    )\n  }, [doses, population, populationFraction, administrations])\n\n  useEffect(() => {\n    const days = remainingAdministrations / avgAdministrationsLastDays\n    const datetime = new Date()\n    datetime.setDate(datetime.getDate() + Math.round(days))\n    setRemainingDays(days)\n    setLastDate(datetime)\n  }, [remainingAdministrations, avgAdministrationsLastDays])\n\n  return (\n    <Container maxWidth='md'>\n      <Grid container direction='column' justify='center' spacing={2}>\n        <Grid item>Termine previsto della campagna vaccinale in <em>{indexedPopulation[area]?.[0]?.nome}</em> contro Sars-CoV-2.</Grid>\n        <Grid item component='h1'>{fmtDate(lastDate)}</Grid>\n        <Grid item>\n          In <Select value={areas.length ? area : ''} onChange={e => setArea(e.target.value)}>{areas.map(a => <MenuItem key={a.area} value={a.area}>{a.nome}</MenuItem>)}</Select> si è iniziato a somministrare il primo vaccino il <em>27 dicembre 2020</em>.\n          A oggi, <em>{fmtDate(lastUpdate).toLowerCase()}</em>, sono state somministrate <em>{fmtInt(administrations)}</em> dosi,\n          ma ne mancano <em>{fmtInt(remainingAdministrations)}</em> per vaccinare l'<TextField value={populationFraction * 100} onChange={e => setPopulationFraction(+e.target.value / 100)} size='small' inputProps={{ type: 'number', min: 60, max: 100, step: 5 }} InputProps={{ endAdornment: <InputAdornment position='end'>%</InputAdornment> }} /> della popolazione\n          con <TextField value={doses} onChange={e => setDoses(+e.target.value)} size='small' inputProps={{ type: 'number', min: 1, max: 2, step: 1 }} /> dosi a testa.\n          Al ritmo di <em>{fmtInt(avgAdministrationsLastDays)}</em> somministrazioni al giorno tenuto negli ultimi <TextField value={lastDays} onChange={e => setLastDays(+e.target.value)} size='small' inputProps={{ type: 'number', min: 1, max: administrationsPerDay.length, step: 1 }} /> giorni,\n          mancano <em>{Math.floor(remainingDays / 365)} anni, {Math.floor((remainingDays % 365) / 30)} mesi e {Math.floor(remainingDays % 12)} giorni</em> prima di raggiungere <em>l'immunità di gregge</em>.\n          Per ottenerla entro <Select value={targetMonth} onChange={e => setTargetMonth(+e.target.value)}>{timeItIT.months.map((m, i) => <MenuItem key={i} value={i}>{m.toLocaleLowerCase()}</MenuItem>)}</Select> <TextField value={targetYear} onChange={e => setTargetYear(+e.target.value)} size='small' inputProps={{ type: 'number', min: (new Date()).getFullYear(), max: (new Date()).getFullYear() + 10, step: 1 }} /> bisognerebbe somministrare una media di <em>{fmtInt(targetAvgAdministrationsPerDay)}</em> dosi al giorno.\n        </Grid>\n        <div className='Cube lt' />\n        <div className='Cube lb' />\n        <div className='Cube rt' />\n        <div className='Cube rb' />\n      </Grid>\n    </Container>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { BrowserRouter as Router, Route } from 'react-router-dom'\nimport { QueryParamProvider } from 'use-query-params'\n\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles'\n\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nconst theme = createMuiTheme({\n  palette: {\n    secondary: {\n      main: '#e82f7d'\n    }\n  },\n  typography: {\n    fontFamily: [\n      '\"Titillium Web\"',\n      'sans-serif'\n    ]\n  }\n})\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <QueryParamProvider ReactRouterRoute={Route}>\n        <ThemeProvider theme={theme}>\n          <App />\n        </ThemeProvider>\n      </QueryParamProvider>\n    </Router>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}